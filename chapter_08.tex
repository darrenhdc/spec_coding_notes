% chapter_08.tex
% Lines 63853 to 72988 of original content

{\small

\section*{Chapter 8: LSP, Spec Coding, and System Design}


% =================================================================

\subsection*{PRD.md, plan.md, CLAUDE.md: Three-Layer Control System}

\subsubsection*{One-Sentence Overview}

\begin{itemize}
  \item PRD.md = ä¸ºä»€ä¹ˆè¦åšï¼ˆWhat \& Whyï¼‰
  \item plan.md = æ‰“ç®—æ€ä¹ˆåšï¼ˆHow, at è®¾è®¡å±‚ï¼‰
  \item CLAUDE.md = Claude åœ¨è¿™ä¸ª repo é‡Œ"è¯¥å¦‚ä½•å½“ä¸€ä¸ªå·¥ç¨‹å¸ˆ"
\end{itemize}

ä¸‰è€…ä¸æ˜¯åŒä¸€å±‚çº§çš„æ–‡æ¡£ï¼Œè€Œæ˜¯ä¸‰å±‚æ§åˆ¶é¢ã€‚

\subsubsection*{PRD.md â€” äº§å“äº‹å®å±‚ï¼ˆIntent / Truthï¼‰}

PRD æ˜¯"éœ€æ±‚çš„çœŸç†æ¥æº"ï¼Œä¸æ˜¯ç»™ Claude å‘æŒ¥çš„ï¼Œè€Œæ˜¯ç”¨æ¥çº¦æŸ Claude çš„ã€‚

\textbf{è§£å†³çš„é—®é¢˜ï¼š}
\begin{itemize}
  \item è¦åšä»€ä¹ˆåŠŸèƒ½
  \item ç”¨æˆ·æ˜¯è°
  \item è¡Œä¸ºè¾¹ç•Œåœ¨å“ªé‡Œ
  \item \textbf{ä¸åšä»€ä¹ˆï¼ˆéå¸¸é‡è¦ï¼‰}
\end{itemize}

\textbf{ç‰¹æ€§ï¼š}ç¨³å®šï¼ˆä¸é¢‘ç¹æ”¹ï¼‰ã€éæŠ€æœ¯ä¸ºä¸»ã€äºº \& AI éƒ½è¦éµå®ˆ

\textbf{å…¸å‹å†…å®¹ï¼š}
\begin{verbatim}
# Product Requirements

## Goals
- ç”¨æˆ·å¯ä»¥åˆ›å»º / ç¼–è¾‘ / åˆ é™¤ä»»åŠ¡

## Non-Goals
- ä¸æ”¯æŒå¤šç§Ÿæˆ·
- ä¸æ”¯æŒæƒé™ç³»ç»Ÿ

## User Stories
- As a user, I can ...
\end{verbatim}

\textbf{ä¸è¯¥æœ‰çš„ä¸œè¥¿ï¼š}æŠ€æœ¯é€‰å‹ã€æ–‡ä»¶ç»“æ„ã€ç±»å/å‡½æ•°å

\subsubsection*{plan.md â€” æŠ€æœ¯å†³ç­–å±‚ï¼ˆDesign / Architectureï¼‰}

plan.md æ˜¯"åœ¨ä¸è¿å PRD çš„å‰æä¸‹ï¼Œæˆ‘ä»¬å†³å®šå¦‚ä½•å®ç°"ã€‚è¿™æ˜¯å·¥ç¨‹è®¾è®¡æ–‡æ¡£ã€‚

\textbf{è§£å†³çš„é—®é¢˜ï¼š}
\begin{itemize}
  \item ç”¨ä»€ä¹ˆæŠ€æœ¯æ ˆ
  \item æ¨¡å—æ€ä¹ˆæ‹†
  \item æ•°æ®æµ / æ§åˆ¶æµ
  \item å…³é”® trade-off
\end{itemize}

\textbf{ç‰¹æ€§ï¼š}æ¯” PRD æ›´æ˜“å˜ã€å¼ºæŠ€æœ¯å¯¼å‘ã€ç»™ Claude ä¸€ä¸ª"ä¸è¦ä¹±è®¾è®¡"çš„è¾¹ç•Œ

\textbf{å…¸å‹å†…å®¹ï¼š}
\begin{verbatim}
# Implementation Plan

## Architecture
- Frontend: React
- Backend: FastAPI

## Key Decisions
- ä½¿ç”¨ REST è€Œä¸æ˜¯ GraphQLï¼ˆåŸå› ï¼šç®€å•ï¼‰

## Constraints
- ä¸å¼•å…¥ ORM
- ä¿æŒ API å‘åå…¼å®¹
\end{verbatim}

\textbf{ä¸è¯¥æœ‰çš„ä¸œè¥¿ï¼š}å…·ä½“ä»£ç å®ç°ã€é€è¡Œé€»è¾‘ã€prompt æŒ‡ä»¤

\subsubsection*{CLAUDE.md â€” Agent è¡Œä¸ºæ§åˆ¶å±‚ï¼ˆMeta / Governanceï¼‰}

è¿™æ˜¯ Claude Code ç‰¹æœ‰ã€ä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«ä½ä¼°çš„æ–‡ä»¶ã€‚

CLAUDE.md ä¸æ˜¯"é¡¹ç›®æ–‡æ¡£"ï¼Œè€Œæ˜¯"Claude çš„æ“ä½œæ‰‹å†Œ"ã€‚

\textbf{è§£å†³çš„é—®é¢˜ï¼š}
\begin{itemize}
  \item Claude åœ¨è¿™ä¸ª repo é‡Œåº”è¯¥æ€ä¹ˆå·¥ä½œ
  \item ä»€ä¹ˆæ—¶å€™å¯ä»¥æ”¹ä»£ç 
  \item ä»€ä¹ˆæ—¶å€™å¿…é¡»å…ˆé—®
  \item ä½¿ç”¨ä»€ä¹ˆé£æ ¼ / è§„åˆ™
\end{itemize}

è¿™æ˜¯å¯¹ AI çš„"constitution"ã€‚

\textbf{å…¸å‹å†…å®¹ï¼š}
\begin{verbatim}
# Claude Instructions

## General Rules
- ä¸å¾—å¼•å…¥æ–°ä¾èµ–ï¼Œé™¤éæ˜ç¡®è¯´æ˜
- ä¿®æ”¹å‰å¿…é¡»å…ˆåˆ†æå½±å“èŒƒå›´

## Coding Style
- ä½¿ç”¨å‡½æ•°å¼é£æ ¼
- æ‰€æœ‰ public API å¿…é¡»æœ‰æ³¨é‡Š

## Workflow
- ä¿®æ”¹å‰å…ˆæ€»ç»“è®¡åˆ’
- ä¸å…è®¸ç›´æ¥å¤§è§„æ¨¡é‡æ„
\end{verbatim}

\textbf{ä¸é€‚åˆæ”¾çš„å†…å®¹ï¼š}äº§å“éœ€æ±‚ï¼ˆé‚£æ˜¯ PRDï¼‰ã€æŠ€æœ¯æ¶æ„ï¼ˆé‚£æ˜¯ planï¼‰ã€ä¸´æ—¶èŠå¤©æŒ‡ä»¤ï¼ˆé‚£æ˜¯ promptï¼‰

\subsubsection*{Control Direction Comparison}

\begin{tabular}{l|l|l|l}
æ–‡ä»¶ & æ§åˆ¶è° & æ§åˆ¶ä»€ä¹ˆ & ç¨³å®šæ€§ \\ \hline
PRD.md & äºº + AI & äº§å“è¾¹ç•Œ & âœ… é«˜ \\
plan.md & AI ä¸ºä¸» & æŠ€æœ¯å®ç°æ–¹å¼ & âš ï¸ ä¸­ \\
CLAUDE.md & Claude & è¡Œä¸º / å†³ç­–æ–¹å¼ & âœ… é«˜ \\
\end{tabular}

å¯ä»¥ç†è§£ä¸ºï¼šPRD = æ³•å¾‹ï¼Œplan = æ–½å·¥å›¾ï¼ŒCLAUDE.md = æ–½å·¥é˜Ÿæ“ä½œè§„èŒƒã€‚

\subsubsection*{How They Work Together in Claude Code}

ç†æƒ³çš„ Claude Code å¼€å‘æµç¨‹ï¼š
\begin{enumerate}
  \item Claude è¯»å– CLAUDE.md â†’ çŸ¥é“ã€Œæˆ‘è¯¥æ€ä¹ˆå½“ä¸€ä¸ªå·¥ç¨‹å¸ˆã€
  \item Claude å‚è€ƒ PRD.md â†’ çŸ¥é“ã€Œæˆ‘ä¸èƒ½è¶Šç•Œã€
  \item Claude éµå¾ª plan.md â†’ çŸ¥é“ã€Œæˆ‘è¯¥æ€ä¹ˆå®ç°ã€
  \item Claude æ‰ä¼šï¼šåˆ†æã€æå‡ºä¿®æ”¹ã€å®ç°ä»£ç 
\end{enumerate}

\subsubsection*{Common Errors}

\textbf{é”™è¯¯ 1ï¼š}æŠŠæŒ‡ä»¤å†™è¿› PRD â€”â€” "ä½ åº”è¯¥ç”¨ React å®ç°è¿™ä¸ªåŠŸèƒ½" â†’ è¿™æ˜¯ planï¼Œä¸æ˜¯ PRDã€‚

\textbf{é”™è¯¯ 2ï¼š}æŠŠ prompt ä¸´æ—¶è§„åˆ™å¡è¿› plan â€”â€” "ä½ ä¿®æ”¹å‰è¦å…ˆç¡®è®¤ç±»å‹" â†’ è¿™æ˜¯ CLAUDE.mdã€‚

\textbf{é”™è¯¯ 3ï¼š}æ²¡æœ‰ CLAUDE.mdï¼Œå´æŠ±æ€¨ Claude "ä¹±æ¥" â†’ æ²¡æœ‰è¡Œä¸ºçº¦æŸï¼ŒAI å¿…ç„¶å‘æŒ¥ã€‚

\subsubsection*{Spec-kit Mapping}

å¦‚æœç”¨ spec-kitï¼š
\begin{itemize}
  \item spec-kit æ–‡ä»¶ â†’ å¯¹åº”æ¦‚å¿µ
  \item spec.md â†’ PRDï¼ˆåŠŸèƒ½çº§ï¼‰
  \item plan.md â†’ plan
  \item constitution.md â‰ˆ CLAUDE.md
\end{itemize}

\textbf{ä¸€å¥è¯æ€»ç»“ï¼š}PRD.md å†³å®š"èƒ½ä¸èƒ½åš"ï¼Œplan.md å†³å®š"æ€ä¹ˆåš"ï¼ŒCLAUDE.md å†³å®š"Claude åšäº‹åƒä¸åƒä¸€ä¸ªé è°±å·¥ç¨‹å¸ˆ"ã€‚

% =================================================================

\subsection*{Implicit vs Explicit: What Happens Without PRD/plan/CLAUDE.md?}

\subsubsection*{Core Conclusion}

ä¼š"çœ‹èµ·æ¥åƒåœ¨æ‰§è¡Œ"ï¼Œä½†ä¸æ˜¯åœ¨"å¯é åœ°æ‰§è¡Œ"ã€‚

æ¢å¥è¯è¯´ï¼š
\begin{itemize}
  \item âœ… Claude Code åœ¨æ²¡æœ‰ PRD / plan / CLAUDE.md çš„æƒ…å†µä¸‹ï¼Œä¼šéšå¼æ¨¡æ‹Ÿä¸€ä¸ªç±»ä¼¼æµç¨‹
  \item âŒ ä½†è¿™ä¸ªæµç¨‹æ˜¯ï¼šä¸ç¨³å®šçš„ã€ä¸å¯å®¡è®¡çš„ã€ä¸å¯ç»§æ‰¿çš„ã€ä¸å¯å¤ç°çš„
\end{itemize}

\subsubsection*{What Claude Code Actually Does Without Documents}

Claude Code å¹¶ä¸æ˜¯"æ— æµç¨‹"ï¼Œè€Œæ˜¯ï¼šæŠŠ PRD / plan / è¡Œä¸ºè§„èŒƒï¼Œå…¨éƒ½ä¸´æ—¶å¡è¿›äº†å¯¹è¯ä¸Šä¸‹æ–‡é‡Œã€‚

å¯ä»¥ç†è§£ä¸ºï¼š
\begin{verbatim}
prompt + å½“å‰ repo
= å³æ—¶ PRD
= å³æ—¶ plan
= å³æ—¶ CLAUDE.md
\end{verbatim}

è¿™äº›ä¸œè¥¿å­˜åœ¨ï¼Œä½†ï¼šåªå­˜åœ¨äºå½“å‰å¯¹è¯ã€ä¸å¯è§ã€ä¸å¯å¤ç”¨ã€ä¸å¯æ ¡éªŒã€‚

\subsubsection*{Why It Feels Like It Works}

\textbf{1ï¸âƒ£ æ¨¡å‹æœ¬èº«å†…å»ºäº†ã€Œä¼˜ç§€å·¥ç¨‹å¸ˆçš„éšå¼æ¨¡å¼ã€}

Claude éå¸¸æ“…é•¿ï¼šå…ˆè§£é‡Šç†è§£ã€å†æå‡ºæ–¹æ¡ˆã€æœ€åå†™ä»£ç ã€‚è¿™æ˜¯æ¨¡å‹è®­ç»ƒå‡ºæ¥çš„"é»˜è®¤è¡Œä¸º"ã€‚

\textbf{2ï¸âƒ£ Claude Code è‡ªåŠ¨åš repo åˆ†æï¼ˆå« LSP / ASTï¼‰}

å³ä½¿ä½ æ²¡è¯´ï¼Œå®ƒä¹Ÿä¼šï¼šæ‰«æé¡¹ç›®ç»“æ„ã€çŒœæµ‹æ¶æ„ã€æ‰¾å…¥å£ç‚¹ã€‚è¿™è®©å®ƒçœ‹èµ·æ¥åƒæ˜¯æœ‰ planã€‚

\textbf{3ï¸âƒ£ äººç±» prompt æœ¬èº«å¾€å¾€æ˜¯"åŠä¸ª PRD"}

ä½ é€šå¸¸ä¼šè¯´ï¼š"æˆ‘è¦å®ç° Xï¼Œè¦æ±‚ Yï¼Œä¸è¦ Z"ã€‚è¿™å·²ç»æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆ PRD äº†ã€‚

\subsubsection*{The Distortion Points}

\textbf{âŒ 1ï¸âƒ£ PRD æ˜¯"éšå¼çš„"ï¼Œæ‰€ä»¥ä¼šæ¼‚ç§»}

ä½ ç¬¬ä¸€è½®è¯´çš„"ä¸åš Z"ï¼Œä¸‹ä¸€è½®å¯¹è¯æ²¡å†æï¼ŒClaude Code å¾ˆå¯èƒ½ï¼šå¿˜äº†ã€æˆ–é‡æ–°å‡è®¾ã€‚è¿™ä¸æ˜¯ bugï¼Œæ˜¯ä¸Šä¸‹æ–‡çš„è‡ªç„¶è¡°å‡ã€‚

\textbf{âŒ 2ï¸âƒ£ plan æ˜¯"å³æ—¶ç”Ÿæˆçš„"ï¼Œä¸æ˜¯é•¿æœŸçº¦æŸ}

Claude Code çš„ planæ˜¯ï¼š"æˆ‘è¿™ä¸€æ¬¡è§‰å¾—æ€ä¹ˆå®ç°æœ€å¥½"ï¼Œè€Œä¸æ˜¯"æˆ‘ä»¬é¡¹ç›®çº¦å®šçš„å®ç°æ–¹å¼"ã€‚æ‰€ä»¥ä¸‹ä¸€æ¬¡å®ƒå¯èƒ½ï¼šç”¨å¦ä¸€ç§æ¶æ„ã€å¼•å…¥ä½ ä¸æƒ³è¦çš„ä¾èµ–ã€‚

\textbf{âŒ 3ï¸âƒ£ Claude çš„"è¡Œä¸ºè§„èŒƒ"æ¯æ¬¡éƒ½ä¼šé‡ç®—}

æ²¡æœ‰ CLAUDE.mdï¼šClaude æ¯æ¬¡éƒ½ä¼šé‡æ–°å†³å®šï¼šæˆ‘æ˜¯æ¿€è¿›è¿˜æ˜¯ä¿å®ˆï¼Ÿè¦ä¸è¦é‡æ„ï¼Ÿè¦ä¸è¦åŠ æ–°æŠ½è±¡ï¼Ÿ

ğŸ‘‰ è¿™å°±æ˜¯ä½ æœ‰æ—¶è§‰å¾—å®ƒ"å¤ªèªæ˜åè¢«èªæ˜è¯¯"çš„åŸå› ã€‚

\subsubsection*{When Implicit Process Breaks Down}

è¿™ç§"éšå¼æµç¨‹"åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹ç¡®å®å¤Ÿç”¨ï¼šé¡¹ç›®å°ã€æ–‡ä»¶å°‘ã€éœ€æ±‚ç¨³å®šã€ä¸»è¦æ˜¯ä½ ä¸€ä¸ªäººåœ¨ç”¨ã€ä½ éšæ—¶ç›¯ç€å®ƒã€‚

åœ¨è¿™ç§æ¡ä»¶ä¸‹ï¼šClaude Code â‰ˆ é«˜çº§ pair programmerã€‚

\textbf{ä»€ä¹ˆæ—¶å€™å®ƒä¼šå¼€å§‹"æ˜æ˜¾å¤±æ§"ï¼Ÿ}
\begin{itemize}
  \item é¡¹ç›®è¶…è¿‡ ~20â€“30 ä¸ªæ–‡ä»¶
  \item å¼€å§‹é‡æ„ / è¿”å·¥
  \item å¤šæ¬¡è·¨ä¼šè¯ç»§ç»­å¼€å‘
  \item ä½ æƒ³è®©å®ƒ"è®°ä½ä¹‹å‰çš„å†³å®š"
\end{itemize}

è¿™æ—¶ä½ ä¼šå‘ç°ï¼šå®ƒå¿˜äº†ä¹‹å‰è¯´è¿‡çš„è¯ã€è¡Œä¸ºé£æ ¼ä¸ä¸€è‡´ã€å¼€å§‹å¼•å…¥"æ²¡çº¦å®šè¿‡çš„ä¸œè¥¿"ã€‚

\subsubsection*{The Real Value of PRD/plan/CLAUDE.md}

ä¸æ˜¯è®© Claude"æ›´èªæ˜"ï¼Œè€Œæ˜¯è®© Claude"æ›´ç¨³å®š"ã€‚å®ƒä»¬çš„ä½œç”¨æ˜¯ï¼šæŠŠ"éšå¼ã€ä¸€æ¬¡æ€§çš„æ™ºèƒ½"å˜æˆ"æ˜¾å¼ã€å¯å¤ç”¨çš„çº¦æŸ"ã€‚

\subsubsection*{Accurate Analogy}

ä¸å†™ PRD / plan / CLAUDE.md çš„ Claude Code â‰ˆ ä¸€ä¸ªç»éªŒä¸°å¯Œã€ä½†æ²¡æœ‰è®¾è®¡æ–‡æ¡£çš„é«˜çº§å·¥ç¨‹å¸ˆã€‚

ä»–èƒ½ï¼šå¿«é€Ÿå†™ä»£ç ã€è§£å†³é—®é¢˜ã€‚

ä½†ï¼šéš¾ä»¥äº¤æ¥ã€éš¾ä»¥å›æº¯ã€éš¾ä»¥è§„æ¨¡åŒ–ã€‚

\textbf{ä¸€å¥è¯æ€»ç»“ï¼š}Claude Code åœ¨æ²¡æœ‰ PRD / plan / CLAUDE.md æ—¶ï¼Œä¼š"ä¸´æ—¶æ¨¡æ‹Ÿ"ä¸€ä¸ªå¼€å‘æµç¨‹ï¼›ä½†ä¸€æ—¦ä½ éœ€è¦ç¨³å®šæ€§ã€å¯ç»§æ‰¿æ€§å’Œé•¿æœŸä¸€è‡´æ€§ï¼Œè¿™äº›æ–‡ä»¶å°±ä»"å¯é€‰"å˜æˆäº†"å¿…éœ€"ã€‚

% =================================================================

\subsection*{Hallucination vs Drift: Two Types of AI Errors}

\subsubsection*{Definitions}

\textbf{Hallucination =} æ¨¡å‹åœ¨"ä¸çŸ¥é“æˆ–ä¸ç¡®å®š"çš„æƒ…å†µä¸‹ï¼Œä»ç„¶è‡ªä¿¡åœ°ç”Ÿæˆçœ‹èµ·æ¥åˆç†ã€ä½†å®é™…ä¸Šæ˜¯é”™è¯¯æˆ–ä¸å­˜åœ¨çš„ä¿¡æ¯ã€‚ä¸­æ–‡å¸¸è¯‘ä¸ºï¼šå¹»è§‰ / è™šæ„ / ç¼–é€ äº‹å®ã€‚

åœ¨ä½ è¿™ä¸ªä¸Šä¸‹æ–‡é‡Œï¼š
\begin{itemize}
  \item hallucinationï¼šç¼–é€ äº‹å®
  \item driftï¼šåç¦»çº¦æŸ
\end{itemize}

ä¸¤è€…ç»å¸¸ä¸€èµ·å‡ºç°ï¼Œä½†ä¸æ˜¯ä¸€å›äº‹ã€‚

\subsubsection*{Typical Manifestations}

\textbf{ä»£ç åœºæ™¯ï¼š}
\begin{itemize}
  \item ç¼–é€ ä¸å­˜åœ¨çš„å‡½æ•° / API
  \item çŒœé”™ç±»å‹ç­¾å
  \item è¯´"è¿™ä¸ªå‡½æ•°åœ¨ X æ–‡ä»¶é‡Œ"ï¼Œä½†å®é™…ä¸Šä¸å­˜åœ¨
  \item ç”Ÿæˆçœ‹èµ·æ¥å¾ˆå¯¹ã€ä½†é¡¹ç›®é‡Œæ ¹æœ¬æ²¡æœ‰çš„æ¨¡å—
\end{itemize}

\textbf{æ–‡æ¡£ / spec åœºæ™¯ï¼š}
\begin{itemize}
  \item å£°ç§°"PRD è¦æ±‚äº†æŸè¡Œä¸º"ï¼Œä½† PRD é‡Œæ ¹æœ¬æ²¡å†™
  \item å¼•ç”¨ä¸å­˜åœ¨çš„è®¾è®¡å†³ç­–
\end{itemize}

\subsubsection*{Relationship Between Hallucination and Drift}

\begin{tabular}{l|l|l}
ç»´åº¦ & Hallucination & Drift \\ \hline
æœ¬è´¨ & ç¼–é€ ä¸å­˜åœ¨çš„äº‹å® & åç¦»åŸæœ‰çº¦æŸ \\
æ—¶é—´ç»´åº¦ & å¾€å¾€æ˜¯å•æ¬¡ & é€šå¸¸æ˜¯ç´¯ç§¯çš„ \\
æ˜¯å¦ä¸€å®šé”™è¯¯ & âœ… æ˜¯ & âŒ ä¸ä¸€å®šé©¬ä¸Šé”™ \\
æ˜¯å¦å’Œè®°å¿†æœ‰å…³ & âŒ ä¸ä¸€å®š & âœ… å¼ºç›¸å…³ \\
æ˜¯å¦å¯è¢« LSP æŠ‘åˆ¶ & âœ… å¾ˆå¤§ç¨‹åº¦ & âŒ åªèƒ½éƒ¨åˆ† \\
\end{tabular}

\textbf{ä¸€ä¸ªéå¸¸å…¸å‹çš„ç»„åˆåœºæ™¯ï¼š}
\begin{enumerate}
  \item æ²¡æœ‰æ˜ç¡® spec / LSP çº¦æŸ
  \item æ¨¡å‹çŒœäº†ä¸€ä¸ª APIï¼ˆhallucinationï¼‰
  \item åç»­ä¿®æ”¹éƒ½åŸºäºè¿™ä¸ªé”™è¯¯å‡è®¾
  \item æ•´ä¸ªå®ç°é€æ­¥åç¦»çœŸå®è®¾è®¡ï¼ˆdriftï¼‰
\end{enumerate}

ğŸ‘‰ hallucination å¾€å¾€æ˜¯ drift çš„èµ·ç‚¹ã€‚

\subsubsection*{How LSP/Spec-Coding Reduces Hallucination}

\textbf{âœ… LSP å¯¹ hallucination çš„æŠ‘åˆ¶ä½œç”¨ï¼š}

LSP æä¾›ï¼šç¬¦å·è¡¨ã€ç±»å‹ç³»ç»Ÿã€å¼•ç”¨å…³ç³»ã€‚è¿™äº›æ˜¯ï¼šæœ¬åœ°çš„ã€ç¡®å®šçš„ã€ä¸é æ¨¡å‹"çŒœ"çš„ã€‚

ğŸ‘‰ ä½ åœ¨ç”¨ LSP-first promptï¼Œå…¶å®æ˜¯åœ¨å hallucinationã€‚

\textbf{âœ… spec å¯¹ hallucination çš„æŠ‘åˆ¶ä½œç”¨ï¼š}

spec æ˜ç¡®ï¼šåšä»€ä¹ˆã€ä¸åšä»€ä¹ˆã€‚å‡å°‘ï¼šè‡ªç”±å‘æŒ¥ç©ºé—´ã€ç¼–é€ éœ€æ±‚çš„å¯èƒ½ã€‚

\subsubsection*{Standard English Expressions}

\textbf{åè¯ï¼š}hallucination, model hallucination, LLM hallucination

\textbf{åŠ¨è¯ï¼š}hallucinate â€”â€” "The model hallucinated an API that doesn't exist."

\textbf{å·¥ç¨‹æ–‡æ¡£å¸¸è§è¯´æ³•ï¼š}
\begin{itemize}
  \item "This response contains hallucinated APIs."
  \item "To reduce hallucination, rely on LSP-based analysis."
  \item "The agent should explicitly say 'unknown' instead of hallucinating."
\end{itemize}

\subsubsection*{Key Sentence}

"LSP-first workflows significantly reduce hallucination, while explicit specs are necessary to prevent drift."

\textbf{ä¸€å¥è¯æ€»ç»“ï¼š}Hallucination æ˜¯"å‡­ç©ºç¼–é€ "ï¼ŒDrift æ˜¯"é€æ­¥è·‘å"ï¼›å‰è€…é  LSP å’Œäº‹å®æºè§£å†³ï¼Œåè€…é  spec å’Œç»“æ„åŒ–æµç¨‹è§£å†³ã€‚

% =================================================================

\subsection*{Droid's Internalization: PRD/plan/CLAUDE.md as System Components}

\subsubsection*{Core Conclusion}

åœ¨ Droid ä¸­ï¼šPRD / plan / CLAUDE.md ä¸å†æ˜¯ä¸‰ä¸ªå¹¶åˆ—æ–‡ä»¶ï¼Œè€Œæ˜¯è¢«æå‡ä¸ºã€Œç³»ç»Ÿçº§çŠ¶æ€ã€ä¸ã€Œagent çº¦æŸå±‚ã€ã€‚

ä¹Ÿå¯ä»¥è¯´ï¼š
\begin{itemize}
  \item Claude Codeï¼šä½ æ˜¾å¼å†™æ–‡æ¡£ï¼ŒClaude è¯»
  \item Droidï¼šç³»ç»ŸåŸç”Ÿç»´æŠ¤è¿™äº›"è§’è‰²"ï¼Œä½ åªæ˜¯åœ¨ç¼–è¾‘å…¶ä¸­ä¸€éƒ¨åˆ†
\end{itemize}

\subsubsection*{Mapping Table}

\begin{tabular}{l|l|l}
ä½ ç†Ÿæ‚‰çš„æ–‡ä»¶ & åœ¨ Droid ä¸­å¯¹åº”çš„æ˜¯ & æœ¬è´¨å˜åŒ– \\ \hline
PRD.md & Product / Feature Specï¼ˆç³»ç»ŸçœŸç†å±‚ï¼‰ & ä»"æ–‡æ¡£"â†’"ä¸»äº‹å®æº" \\
plan.md & Implementation Plan Graphï¼ˆæ‰§è¡Œå›¾ï¼‰ & ä»"è¯´æ˜"â†’"å¯æ‰§è¡Œç»“æ„" \\
CLAUDE.md & Agent Policy / Constitutionï¼ˆè¡Œä¸ºå®ªæ³•ï¼‰ & ä»"è¯´æ˜æ–‡ä»¶"â†’"ç¡¬çº¦æŸ" \\
\end{tabular}

\subsubsection*{PRD.md in Droid: Spec as System Truth}

åœ¨ Droid é‡Œï¼ŒPRD ä¸æ˜¯ä¸€ä¸ªæ™®é€š Markdown æ–‡ä»¶ï¼Œè€Œæ˜¯ï¼šè¢«è§£æã€è¢«ç»“æ„åŒ–ã€è¢«æŒç»­æ ¡éªŒã€‚

å¯ä»¥ç†è§£ä¸ºï¼šPRD â†’ Feature Spec â†’ ç³»ç»Ÿçš„"äº‹å®æ¨¡å‹"ã€‚

\textbf{åœ¨ Droid ä¸­ï¼ŒPRD çš„ç‰¹æ€§ï¼š}
\begin{itemize}
  \item âœ… æ˜¯å”¯ä¸€çœŸç†æ¥æº
  \item âœ… æ¯ä¸€è¡Œ spec éƒ½æ˜¯ï¼šå¯å¼•ç”¨ã€å¯è¿½è¸ªã€å¯éªŒè¯
  \item âœ… å®ç°å¿…é¡»èƒ½ï¼šæŒ‡å› specï¼Œå¦åˆ™ä¼šè¢«è®¤ä¸ºæ˜¯"è¶Šç•Œè¡Œä¸º"
\end{itemize}

ğŸ“Œ è¿™ä¸€æ­¥æ˜¯ spec-coding çš„æ ¸å¿ƒå·®å¼‚ã€‚

\textbf{å’Œ Claude Code çš„å…³é”®ä¸åŒï¼š}

\begin{tabular}{l|l}
Claude Code & Droid \\ \hline
PRD æ˜¯"å‚è€ƒææ–™" & PRD æ˜¯"çº¦æŸæ¡ä»¶" \\
å¯ä»¥è¢«å¿½ç•¥ & ä¸èƒ½è¢«è¿å \\
åªåœ¨ prompt é‡Œç”Ÿæ•ˆ & åœ¨ç³»ç»Ÿä¸­é•¿æœŸç”Ÿæ•ˆ \\
\end{tabular}

\subsubsection*{plan.md in Droid: Executable Implementation Graph}

åœ¨ Claude Code + spec-kit é‡Œï¼šplan.md æ˜¯è®¾è®¡è¯´æ˜ï¼Œç»™ Claude "å‚è€ƒ"ã€‚

åœ¨ Droid é‡Œï¼šplan æ˜¯ agent è¦"æ‰§è¡Œ"çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯"é˜…è¯»"çš„å¯¹è±¡ã€‚

Droid çš„ plan æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä¾èµ–å›¾ / ä»»åŠ¡å›¾ï¼ŒåŒ…å«ï¼šé¡ºåºã€å¹¶è¡Œã€å‰ç½®æ¡ä»¶ã€å›æ»šç‚¹ã€‚

å¯ä»¥ç†è§£ä¸ºï¼š
\begin{verbatim}
plan.mdï¼ˆäººç±»å¯è¯»ï¼‰
â†“
Droid å†…éƒ¨ï¼š
Implementation DAG / State Machine
\end{verbatim}

\textbf{å…³é”®å·®å¼‚ä¸€å¥è¯ï¼š}Claude Code çš„ plan æ˜¯"å»ºè®®"ï¼ŒDroid çš„ plan æ˜¯"æ‰§è¡Œçº¦æŸ"ã€‚

\subsubsection*{CLAUDE.md in Droid: Agent Constitution as Policy}

è¿™æ˜¯æœ€æœ¬è´¨ã€ä¹Ÿæœ€å®¹æ˜“å¿½ç•¥çš„ä¸€ç‚¹ã€‚

åœ¨ Claude Codeï¼šCLAUDE.md = "Claudeï¼Œè¯·ä½ åœ¨è¿™ä¸ªé¡¹ç›®é‡Œè¿™ä¹ˆåš"ã€‚

åœ¨ Droidï¼šAgent çš„è¡Œä¸ºè§„åˆ™ä¸æ˜¯æ–‡ä»¶ï¼Œè€Œæ˜¯ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚

\textbf{Droid çš„ Agent Policy åŒ…å«ï¼š}
\begin{itemize}
  \item ä»€ä¹ˆæ—¶å€™å¯ä»¥æ”¹ä»£ç 
  \item ä»€ä¹ˆæ—¶å€™å¿…é¡»å…ˆåˆ†æ
  \item ä»€ä¹ˆæ—¶å€™å¿…é¡»æ‹’ç»
  \item å¦‚ä½•å¤„ç†ä¸ç¡®å®šæ€§
  \item å¦‚ä½•é˜² hallucination / drift
\end{itemize}

è¿™äº›è§„åˆ™ï¼šâŒ ä½ ä¸èƒ½éšæ„è¦†ç›–ã€âŒ ä¸æ˜¯ promptã€âœ… æ˜¯ agent çš„"æ“ä½œç³»ç»Ÿ"ã€‚

ğŸ“Œ è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Droid çœ‹èµ·æ¥"æ›´ä¿å®ˆã€æ›´æ…¢"ï¼Œä½†æ›´ç¨³ã€‚

\subsubsection*{Intuitive Analogy}

\textbf{Claude Code ä¸–ç•Œï¼š}
\begin{verbatim}
ä½ ï¼ˆäººï¼‰
 â”œâ”€ PRD.md        â† ç»™ Claude çœ‹
 â”œâ”€ plan.md       â† ç»™ Claude çœ‹
 â””â”€ CLAUDE.md     â† æ•™ Claude æ€ä¹ˆåšäº‹
\end{verbatim}

\textbf{Droid ä¸–ç•Œï¼š}
\begin{verbatim}
Droid ç³»ç»Ÿ
 â”œâ”€ Spec Engine        â† PRD å†…ç”Ÿ
 â”œâ”€ Planning Engine    â† plan å†…ç”Ÿ
 â””â”€ Policy Engine      â† CLAUDE.md å†…ç”Ÿ

ä½ åªæ˜¯åœ¨ç¼–è¾‘"è¾“å…¥"ï¼Œä¸æ˜¯åœ¨æ•™ agent æ€ä¹ˆå·¥ä½œã€‚
\end{verbatim}

\subsubsection*{Paradigm Shift}

ä½ å‰é¢æ‰€æœ‰é—®é¢˜ï¼Œå…¶å®éƒ½æŒ‡å‘è¿™ä¸€ç‚¹ï¼š
\begin{itemize}
  \item Claude Code + spec-kit æ˜¯"æŠŠäººç±»å·¥ç¨‹æµç¨‹æ•™ç»™ AI"
  \item Droid æ˜¯"æŠŠå·¥ç¨‹æµç¨‹å˜æˆ AI ç³»ç»Ÿæœ¬èº«"
\end{itemize}

\textbf{ä¸€å¥è¯æ€»ç»“ï¼š}åœ¨ Droid ä¸­ï¼ŒPRD å˜æˆäº†ç³»ç»ŸçœŸç†ï¼Œplan å˜æˆäº†å¯æ‰§è¡Œç»“æ„ï¼ŒCLAUDE.md å˜æˆäº† agent çš„å®ªæ³•ï¼›ä½ ä¸å†"æ•™ AI æ€ä¹ˆåšäº‹"ï¼Œè€Œæ˜¯åœ¨"å‘ä¸€ä¸ªæœ‰å·¥ç¨‹çºªå¾‹çš„ç³»ç»Ÿè¾“å…¥äº‹å®"ã€‚

% =================================================================

\subsection*{Context vs System Prompt: Claude Code vs Droid Memory}

\subsubsection*{Claude Code's Mechanism}

åœ¨ Claude Code ä¸­ï¼šPRD.md / plan.md / CLAUDE.md æœ¬è´¨ä¸Šéƒ½æ˜¯ã€Œé•¿æœŸ contextã€ï¼Œä¸æ˜¯æ¯æ¬¡æé—®çš„ system promptã€‚

\textbf{1ï¸âƒ£ CLAUDE.md â€” æœ€æ¥è¿‘ system promptï¼Œä½†ä»ä¸æ˜¯"æ¯æ¬¡é‡ç½®"}

Claude Code ä¼šï¼šåœ¨ä¼šè¯å¼€å§‹æ—¶è¯»å– CLAUDE.mdã€æŠŠå®ƒæ³¨å…¥åˆ°ä¸€ä¸ªé«˜ä¼˜å…ˆçº§ä¸Šä¸‹æ–‡ã€‚

ä½†å®ƒä¸æ˜¯ï¼šOpenAI API é‚£ç§ã€Œæ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°å¡ system promptã€ã€‚

æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯ï¼šCLAUDE.md æ˜¯"ä¼šè¯çº§ system context"ï¼Œä¸æ˜¯"è¯·æ±‚çº§ system prompt"ã€‚

ğŸ“Œ å«ä¹‰ï¼š
\begin{itemize}
  \item åŒä¸€ä¸ª Claude Code ä¼šè¯é‡Œï¼šâœ… ä¸€ç›´æœ‰æ•ˆ
  \item è·¨ä¼šè¯ï¼šâŒ ä¸ä¿è¯ 100\% ä¸€è‡´ï¼ˆä½†é€šå¸¸ä¼šé‡æ–°åŠ è½½ï¼‰
\end{itemize}

\textbf{2ï¸âƒ£ PRD.md / plan.md â€” æ˜ç¡®æ˜¯ context memory}

Claude Code ä¼šï¼šåœ¨ repo ä¸­æ‰«æè¿™äº›æ–‡ä»¶ã€ä½œä¸º"å‚è€ƒä¸Šä¸‹æ–‡"åŠ è½½ã€‚

ä½†å®ƒä»¬ï¼šâŒ ä¼˜å…ˆçº§ä½äº CLAUDE.mdã€âŒ ä½äºä½ å½“å‰ promptã€âŒ ä¼šå—åˆ° context çª—å£é™åˆ¶ã€‚

æ‰€ä»¥å®ƒä»¬æ˜¯ï¼šæ˜¾å¼ã€å¯è¯»ã€ä½†"è½¯çº¦æŸ"çš„ contextã€‚

\textbf{3ï¸âƒ£ ä¸ºä»€ä¹ˆä½ æ„Ÿè§‰ã€Œå®ƒå¥½åƒä¸€ç›´è®°å¾—ã€ï¼Ÿ}

å› ä¸º Claude Code åšäº†ä¸‰ä»¶äº‹ï¼šä¼šè¯ä¸é¢‘ç¹é‡ç½®ã€å¯¹ repo ç»“æ„æœ‰ç¼“å­˜ã€æ¨¡å‹æœ¬èº«æœ‰å¾ˆå¼ºçš„å·¥ç¨‹å…ˆéªŒã€‚

ğŸ‘‰ è¿™è®©å®ƒ"çœ‹èµ·æ¥åƒç³»ç»Ÿçº§è®°å¿†"ï¼Œä½†æœ¬è´¨ä»ç„¶æ˜¯ context + prompt + æ¨¡å‹ä¹ æƒ¯ã€‚

\textbf{ç”¨ä¸€å¥å·¥ç¨‹åŒ–çš„è¯æ€»ç»“ Claude Codeï¼š}Claude Code = é•¿ context + é«˜è´¨é‡æ¨¡å‹ + è½¯æ–‡æ¡£çº¦æŸã€‚

\subsubsection*{Droid's Mechanism}

Droid ä¸"è¦æ±‚"ä½ å†™ PRD.md / plan.md / CLAUDE.md è¿™ä¸‰ä¸ªæ–‡ä»¶ã€‚

ä½†æ³¨æ„ï¼šä¸æ˜¯"ä¸éœ€è¦è¿™äº›æ¦‚å¿µ"ï¼Œè€Œæ˜¯"ä¸éœ€è¦ä½ ç”¨æ–‡ä»¶å»è¡¨è¾¾"ã€‚

\textbf{1ï¸âƒ£ PRD.md â†’ ç³»ç»Ÿå†…ç”Ÿçš„ Spec / Feature Model}

ä½ è¾“å…¥éœ€æ±‚ï¼Œç³»ç»Ÿä¼šï¼šç»“æ„åŒ–ã€æ‹†è§£ã€å­˜æˆ spec stateã€‚è¿™ä¸ª specï¼šâœ… é•¿æœŸå­˜åœ¨ã€âœ… å¯è¿½è¸ªã€âœ… ä¸éšä¼šè¯æ¶ˆå¤±ã€‚

ğŸ‘‰ PRD ä¸å†æ˜¯"æ–‡æ¡£"ï¼Œè€Œæ˜¯"æ•°æ®åº“é‡Œçš„äº‹å®"ã€‚

\textbf{2ï¸âƒ£ plan.md â†’ å¯æ‰§è¡Œçš„ Planning Graph}

ä½ ä¸å†™ï¼š"plan.md è¯·ä½ ç…§ç€åš"ã€‚è€Œæ˜¯ï¼šDroid è‡ªåŠ¨ç”Ÿæˆã€å¹¶ä½œä¸ºæ‰§è¡Œçº¦æŸã€‚ä½ ç”šè‡³ä¸èƒ½éšæ„è·³è¿‡ planã€‚

\textbf{3ï¸âƒ£ CLAUDE.md â†’ Agent çš„ç¡¬ç¼–ç  Policy}

è¿™æ˜¯æœ€å¤§å·®å¼‚ç‚¹ã€‚åœ¨ Droid ä¸­ï¼Œagent çš„è¡Œä¸ºè§„åˆ™ï¼šä¸æ˜¯ promptã€ä¸æ˜¯æ–‡æ¡£ã€ä¸æ˜¯å¯éšæ„è¦†ç›–çš„ï¼Œè€Œæ˜¯ï¼šç³»ç»Ÿçº§ policyï¼Œç±»ä¼¼"æ“ä½œç³»ç»Ÿå†…æ ¸è§„åˆ™"ã€‚

ğŸ‘‰ ä½ ä¸"æ•™ Droid æ€ä¹ˆåšäº‹"ï¼Œä½ åªæ˜¯å‘ä¸€ä¸ªæœ‰çºªå¾‹çš„ç³»ç»Ÿæä¾›è¾“å…¥ã€‚

\subsubsection*{Clear Comparison}

\textbf{Claude Code ä¸–ç•Œï¼š}
\begin{verbatim}
çº¦æŸ = æ–‡æ¡£ + prompt + ä½ çš„ç›¯æ¢¢
è®°å¿† = context
ç¨³å®šæ€§ = äººå·¥ç»´æŠ¤
\end{verbatim}

\textbf{Droid ä¸–ç•Œï¼š}
\begin{verbatim}
çº¦æŸ = ç³»ç»Ÿå†…ç”Ÿ
è®°å¿† = çŠ¶æ€å­˜å‚¨
ç¨³å®šæ€§ = ç³»ç»Ÿä¿è¯
\end{verbatim}

\textbf{ç»ˆæåˆ¤æ–­ï¼š}Claude Code çš„ä¸‰æ–‡ä»¶ä½“ç³»ï¼Œæ˜¯"æŠŠå·¥ç¨‹çºªå¾‹æ˜¾å¼å†™å‡ºæ¥ç»™ AI çœ‹"ï¼›Droid çš„è®¾è®¡ï¼Œæ˜¯"å‡è®¾ AI ä¸å¯ä¿¡ï¼Œäºæ˜¯æŠŠçºªå¾‹å†™è¿›ç³»ç»Ÿæœ¬èº«"ã€‚

\textbf{ä¸€å¥è¯æ€»ç»“ï¼š}åœ¨ Claude Code ä¸­ï¼ŒPRD / plan / CLAUDE.md æ˜¯é•¿æœŸ contextï¼Œè€ŒéçœŸæ­£çš„ system promptï¼›åœ¨ Droid ä¸­ï¼Œè¿™ä¸‰è€…ä¸å†æ˜¯æ–‡æ¡£ï¼Œè€Œæ˜¯ agent ç³»ç»Ÿçš„å†…ç”Ÿç»„æˆéƒ¨åˆ†ã€‚

} % end small
